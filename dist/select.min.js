/*! jquery-cascading-select-list 2016-07-31 */
function MYSelection(a,b){this.rootElement=$("#"+a),this.options=b,this.buildElments(),this.selectedValues=[],this.bindEvents()}MYSelection.prototype.buildElments=function(){this.rootElement.addClass("zysContainer"),this.buildColumns(),this.populateFirstColumn()},MYSelection.prototype.buildColumns=function(){var a=1;this.options&&this.options.apis&&Array.isArray(this.options.apis)&&(a=this.options.apis.length),this.options.apis.forEach(function(a,b,c){var d=$("<div></div>").addClass("column"),e="string"==typeof a?a:a.url,f=$("<ul></ul>").attr("data-apiurl",e).attr("data-apiindex",b);d.append(f),this.rootElement.append(d)},this),this.rootElement.append($("<div style='clear:both;'></div>"))},MYSelection.prototype.populateFirstColumn=function(){var a=this;if(this.options&&this.options.apis[0]){var b=this.options.apis[0],c=this.rootElement.find(".column").eq(0).find("ul");this.fetchItemData(b,function(b){a.renderDataList(b,c)})}},MYSelection.prototype.fetchItemData=function(a,b){var c=this.normalizeAPI(a),d=c.url,e=c.parser;this.ajax(d,function(a){e&&(a=e(a)),b&&b(a)})},MYSelection.prototype.renderDataList=function(a,b){b.html(""),Array.isArray(a)&&a.length>0&&a.forEach(function(a,c,d){var e=$("<li></li>").attr({"data-value":a.value,"data-id":a.id}).append(a.text);b.append(e)},this)},MYSelection.prototype.bindEvents=function(){var a=this;this.rootElement.on("click",".column ul li",function(b){var c=$(this);if(c.hasClass("active"))return!1;c.siblings().removeClass("active"),c.addClass("active");var d=$(this).attr("data-id"),e=$(this).parent(),f=parseInt(e.attr("data-apiindex")),g=$('ul[data-apiindex="'+(f+1)+'"]'),h=a.options.apis[f+1];a.resetColumnContents(f),a.resetSelectedValues(f,{id:d,text:c.text(),value:c.attr("data-value")}),a.fireEventListener("changed",a.getSelectedValues()),h&&g&&a.fetchItemData(a.normalizeAPI(h,d),function(b){a.renderDataList(b,g)})})},MYSelection.prototype.normalizeAPI=function(a,b){var c="",d=null;return"string"==typeof a?c=a:"object"==typeof a&&("string"==typeof a.url&&(c=a.url),"function"==typeof a.parser&&(d=a.parser)),b&&(c=c.replace("{id}",b)),{url:c,parser:d}},MYSelection.prototype.resetColumnContents=function(a){for(var b=this.options.apis.length;a<b-1;)a++,$('ul[data-apiindex="'+a+'"]').html("")},MYSelection.prototype.resetSelectedValues=function(a,b){this.selectedValues[a]=b,this.selectedValues.splice(a+1)},MYSelection.prototype.ajax=function(a,b){$.ajax({type:"GET",url:a,dataType:"json",success:b,error:function(a,b){alert("Ajax error!")}})},MYSelection.prototype.addEventListener=function(a,b){this.rootElement.on(a,b)},MYSelection.prototype.removeEventListener=function(a,b){this.rootElement.off(a,b)},MYSelection.prototype.fireEventListener=function(a,b){this.rootElement.trigger(a,b)},MYSelection.prototype.getSelectedValues=function(){return this.selectedValues};